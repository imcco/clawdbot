name: Fork Sync (Minimal)

on:
  schedule:
    - cron: '0 2 * * *'
  workflow_dispatch:
    inputs:
      force_sync:
        description: 'Force sync all forks'
        required: false
        default: 'false'
        type: boolean

jobs:
  sync-forks:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        
    - name: Setup Git
      run: |
        git config --global user.name 'OpenClaw Fork Sync'
        git config --global user.email 'openclaw@localhost'
        
    - name: Minimal Fork Sync
      env:
        FORK_SYNC_PAT: ${{ secrets.FORK_SYNC_PAT }}
      run: |
        echo "ðŸ”„ Starting minimal fork sync"
        echo "ðŸ“ Repository: ${{ github.repository }}"
        
        # æœ€ç®€åŒ–çš„æµ‹è¯•
        if command -v gh >/dev/null 2>&1; then
          echo "âœ… gh CLI available"
          gh --version
          
          # æµ‹è¯•åŸºæœ¬å‘½ä»¤
          echo "ðŸ§ª Testing basic commands..."
          pwd
          ls -la
          
          # æµ‹è¯•GitHubè¿žæŽ¥ï¼ˆä¸ä½¿ç”¨å¤æ‚è®¤è¯ï¼‰
          echo "ðŸ” Testing GitHub connection..."
          git ls-remote origin main
          
          echo "âœ… Minimal test completed successfully"
        else
          echo "âŒ gh CLI not available"
          exit 1
        fi
        
    - name: Sync Summary
      if: always()
      run: |
        echo "## ðŸ”„ Minimal Fork Sync Test" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Repository**: ${{ github.repository }}" >> $GITHUB_STEP_SUMMARY
        echo "**Test Time**: $(date -u +'%Y-%m-%d %H:%M:%S UTC')" >> $GITHUB_STEP_SUMMARY
        echo "**Status**: Basic connectivity test completed" >> $GITHUB_STEP_SUMMARY